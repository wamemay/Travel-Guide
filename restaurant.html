<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¥</text></svg>">
    <title>æ³•åœ‹é¤å»³è©•é‘‘</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Poppins:wght@600&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #0056b3; --accent: #ff4757; --bg: #f0f2f5; --card-bg: #ffffff; --text: #2d3436; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; justify-content: center; min-height: 100vh; }
        .container { background: var(--card-bg); width: 100%; max-width: 650px; padding: 2rem; border-radius: 24px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); position: relative; }
        
        /* å°è¦½åˆ— */
        .nav-header { display: flex; justify-content: flex-end; margin-bottom: 10px; }
        .nav-link { text-decoration: none; color: #2d98da; background-color: #ecf6ff; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; font-weight: bold; transition: all 0.2s; }
        
        h2 { text-align: center; color: #1e272e; margin-bottom: 1.5rem; font-family: 'Poppins', sans-serif; }
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        label { display: block; margin-bottom: 0.5rem; font-weight: 700; color: #636e72; }
        input[type="text"], input[type="password"] { width: 100%; padding: 12px; border: 2px solid #dfe6e9; border-radius: 12px; font-size: 1rem; margin-bottom: 1rem; box-sizing: border-box; }
        input:focus { border-color: var(--primary); outline: none; }
        
        button { width: 100%; padding: 14px; background: linear-gradient(135deg, #0984e3, #0056b3); color: white; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 10px; }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(9, 132, 227, 0.3); }
        button:disabled { background: #b2bec3; transform: none; }
        
        #photoBtn { background: linear-gradient(135deg, #ff7675, #d63031); display: none; }
        #status { text-align: center; margin-top: 15px; color: #636e72; min-height: 20px; }
        #result { margin-top: 2rem; line-height: 1.8; color: #2d3436; }
        
        /* Markdown è¡¨æ ¼æ¨£å¼ */
        table { width: 100%; border-collapse: collapse; margin: 15px 0; border-radius: 10px; overflow: hidden; box-shadow: 0 0 0 1px #dfe6e9; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #dfe6e9; }
        th { background-color: #f1f2f6; font-weight: bold; }
        
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 0.8rem; border-bottom: 1px dashed #dfe6e9; font-size: 0.85rem; color: #636e72; }
        .reset-link { color: #ff4757; cursor: pointer; font-weight: bold; padding: 4px 8px; border-radius: 4px; background: rgba(255, 71, 87, 0.1); }
    </style>
</head>
<body>

<div class="container">
    <div class="nav-header"><a href="index.html" class="nav-link">ğŸ§­ åˆ‡æ›è‡³æ—…éŠè¬äº‹é€š â†’</a></div>
    <h2>ğŸ‡«ğŸ‡· æ³•åœ‹é¤å»³è©•é‘‘</h2>
    
    <div id="loginSection" class="section active">
        <label>è«‹è¼¸å…¥ Gemini API Key ğŸ”‘</label>
        <input type="password" id="apiKeyInput" placeholder="è²¼ä¸Š Key (æš«å­˜æ–¼æ­¤åˆ†é )">
        <button onclick="saveKey()">ç¢ºèªä¸¦é–‹å§‹ä½¿ç”¨</button>
    </div>

    <div id="searchSection" class="section">
        <div class="top-bar"><span>âœ… API Key å·²å°±ç·’</span><span class="reset-link" onclick="clearKey()">ğŸ”„ é‡è¨­ Key</span></div>
        <label>é¤å»³åç¨± + åŸå¸‚ ğŸ½ï¸</label>
        <input type="text" id="restaurantName" placeholder="ä¾‹å¦‚: Pink Mamma, Paris">
        <button onclick="startAnalysis()" id="btn">ğŸš€ é–‹å§‹è©•é‘‘</button>
        <button onclick="openPhotos()" id="photoBtn">ğŸ“¸ æŸ¥çœ‹ç¶²å‹å¯¦æ‹é¤é»ç…§</button>
        <div id="status"></div>
        <div id="result"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
    window.onload = function() { checkSession(); };
    const apiKeyInput = document.getElementById('apiKeyInput');
    const restaurantInput = document.getElementById('restaurantName');

    // æ³¨æ„ï¼šå·²ç§»é™¤ Enter éµç›£è½ï¼Œé¿å…è¼¸å…¥æ³•èª¤è§¸

    function openPhotos() {
        const val = restaurantInput.value;
        if(val) window.open(`https://www.google.com/search?tbm=isch&q=${encodeURIComponent(val + " food menu")}`, '_blank');
    }

    function checkSession() {
        if (sessionStorage.getItem('geminiKey')) showSearchUI();
        else showLoginUI();
    }

    function saveKey() {
        const key = apiKeyInput.value.trim();
        if (!key) { alert("è«‹è¼¸å…¥ API Key"); return; }
        sessionStorage.setItem('geminiKey', key);
        showSearchUI();
    }

    function clearKey() {
        sessionStorage.removeItem('geminiKey');
        document.getElementById('result').innerHTML = '';
        document.getElementById('photoBtn').style.display = 'none';
        apiKeyInput.value = ''; 
        showLoginUI();
    }

    function showLoginUI() {
        document.getElementById('loginSection').classList.add('active');
        document.getElementById('searchSection').classList.remove('active');
    }

    function showSearchUI() {
        document.getElementById('loginSection').classList.remove('active');
        document.getElementById('searchSection').classList.add('active');
    }

    async function startAnalysis() {
        const apiKey = sessionStorage.getItem('geminiKey');
        const restaurant = restaurantInput.value;
        const resultDiv = document.getElementById('result');
        const statusDiv = document.getElementById('status');
        const btn = document.getElementById('btn');
        const photoBtn = document.getElementById('photoBtn');

        if (!apiKey) { clearKey(); return; }
        if (!restaurant) { alert("è«‹è¼¸å…¥é¤å»³åç¨±"); return; }

        resultDiv.innerHTML = '';
        photoBtn.style.display = 'none'; 
        btn.disabled = true;
        statusDiv.innerHTML = 'ğŸ”„ AI æ­£åœ¨æŸ¥é–±ç±³å…¶æ—èˆ‡ Google è©•è«–...';

        try {
            // æŒ‡å®šä½¿ç”¨ gemini-2.5-flash
            const modelName = 'gemini-2.5-flash';

            const prompt = `
                ä½ æ˜¯ä¸€ä½åš´æ ¼ä¸”è³‡è¨Šç²¾æº–çš„æ³•åœ‹ç¾é£Ÿè©•è«–å®¶ã€‚ä½¿ç”¨è€…æƒ³æŸ¥è©¢é¤å»³ "${restaurant}"ã€‚
                
                é‡è¦æŒ‡ä»¤ï¼š
                1. è«‹å…ˆç¢ºèªé€™å®¶é¤å»³æ˜¯å¦å­˜åœ¨æ–¼è©²åŸå¸‚ã€‚å¦‚æœä½¿ç”¨è€…è¼¸å…¥çš„æ˜¯ "åœ°ä¸­æµ·é¤å»³" é€™ç¨®æ¨¡ç³Šé—œéµå­—ï¼Œè€Œè·‘å‡º "å’–å•¡å»³" çš„è³‡è¨Šï¼Œé€™æ˜¯åš´æ ¼ç¦æ­¢çš„ã€‚è«‹å‹™å¿…ç¢ºèªé¤å»³é¡å‹æ­£ç¢ºã€‚
                2. è‹¥ä¸ç¢ºå®šæˆ–æ‰¾ä¸åˆ°ç¢ºåˆ‡è³‡æ–™ï¼Œè«‹ç›´æ¥èªªã€Œæ‰¾ä¸åˆ°ç›¸é—œé¤å»³ï¼Œè«‹æä¾›æ›´ç²¾ç¢ºçš„åç¨±ã€ã€‚
                3. **ä¸éœ€è¦**æä¾›åœ°åœ–å°èˆªé€£çµã€‚

                å›è¦†æ ¼å¼ (Markdown)ï¼š
                
                ### 1. ğŸ“‹ é¤å»³ç°¡ä»‹
                | é …ç›® | å…§å®¹ |
                | :--- | :--- |
                | **æ–™ç†é¢¨æ ¼** | (è«‹ç²¾æº–åˆ¤æ–·ï¼Œå¦‚ï¼šå‚³çµ±æ³•å¼ã€ç¾©å¼ã€æ—©åˆé¤) |
                | **åƒ¹æ ¼å€é–“** | (ç”¨ â‚¬ è¡¨ç¤ºï¼Œä¾‹å¦‚ â‚¬â‚¬) |
                | **Google è©•åˆ†** | (è‹¥ç„¡è«‹ä¼°è¨ˆï¼Œä¾‹å¦‚ 4.5 â­) |
                | **è¨‚ä½å»ºè­°** | (éœ€ææ—©å¤šä¹…ï¼Ÿå¯å¦ç¾å ´ï¼Ÿ) |

                ### 2. ğŸ¥˜ å¿…é»ä¸‰å¯¶ (é™„æ³•æ–‡)
                (åˆ—å‡º 3 é“æœ€å—æ­¡è¿èœè‰²ï¼Œæ ¼å¼ï¼š**æ³•æ–‡åŸå** - ä¸­æ–‡ï¼šæ¨è–¦ç†ç”±)

                ### 3. ğŸ˜ˆ é¤å»³è©•é‘‘
                * âœ… **å„ªé»**ï¼š
                * âš ï¸ **é›·é»/æ³¨æ„**ï¼š

                ### 4. ğŸ“ æ·±åº¦ç¸½çµ
                (è«‹å¤šå¯«ä¸€é»ï¼ŒåŒ…å«é€™å®¶åº—é©åˆä»€éº¼æ¨£çš„äººã€ä»€éº¼å ´åˆã€èˆ‡åŒé¡å‹é¤å»³ç›¸æ¯”çš„ç‰¹è‰²ã€ä»¥åŠæœ€çµ‚å»ºè­°ï¼šå€¼å¾—å°ˆç¨‹å» / é †è·¯åƒ / å¿«é€ƒ)
            `;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });

            if (!response.ok) throw new Error("API é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ Key æˆ–ç¨å¾Œå†è©¦");

            const data = await response.json();
            const text = data.candidates[0].content.parts[0].text;
            
            resultDiv.innerHTML = marked.parse(text);
            statusDiv.innerHTML = 'âœ¨ åˆ†æå®Œæˆ';
            photoBtn.style.display = 'block';

        } catch (error) {
            resultDiv.innerHTML = `<span style="color:#d63031;">âŒ éŒ¯èª¤: ${error.message}</span>`;
            statusDiv.innerHTML = '';
        } finally {
            btn.disabled = false;
        }
    }
</script>
</body>
</html>
