<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ§­</text></svg>">
    <title>æ³•åœ‹æ—…éŠè¬äº‹é€š</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Poppins:wght@600&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #2d98da; --accent: #fc5c65; --bg: #f1f2f6; --card-bg: #ffffff; --text: #2f3542; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; justify-content: center; min-height: 100vh; }
        .container { background: var(--card-bg); width: 100%; max-width: 650px; padding: 2rem; border-radius: 24px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); position: relative; }

        /* å°è¦½åˆ— */
        .nav-header { display: flex; justify-content: flex-end; margin-bottom: 10px; }
        .nav-link { text-decoration: none; color: #0056b3; background-color: #e1f0ff; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; font-weight: bold; transition: all 0.2s; }

        h2 { text-align: center; color: #1e272e; margin-bottom: 1.5rem; font-family: 'Poppins', sans-serif; }
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        label { display: block; margin-bottom: 0.5rem; font-weight: 700; color: #57606f; }
        input[type="text"], input[type="password"] { width: 100%; padding: 12px; border: 2px solid #dfe4ea; border-radius: 12px; font-size: 1rem; margin-bottom: 1rem; box-sizing: border-box; }
        input:focus { border-color: var(--primary); outline: none; }

        button { width: 100%; padding: 14px; background: linear-gradient(135deg, #45aaf2, #2d98da); color: white; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 10px; }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(45, 152, 218, 0.3); }
        button:disabled { background: #a4b0be; transform: none; }

        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 0.8rem; border-bottom: 1px dashed #dfe4ea; font-size: 0.85rem; color: #747d8c; }
        .reset-link { color: var(--accent); cursor: pointer; font-weight: bold; padding: 4px 8px; border-radius: 4px; background: rgba(252, 92, 101, 0.1); }
        
        #status { text-align: center; margin-top: 15px; color: #747d8c; min-height: 20px; }
        
        /* --- å¡ç‰‡å¼æ’ç‰ˆè¨­è¨ˆ (è§£æ±ºæ‰‹æ©Ÿè¡¨æ ¼é›£è®€å•é¡Œ) --- */
        .result-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.2rem;
            border-left: 5px solid var(--primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .result-card h3 { margin-top: 0; color: #2d98da; border-bottom: 1px solid #eee; padding-bottom: 8px; font-size: 1.2rem; }
        .result-card ul { padding-left: 20px; margin-bottom: 10px; }
        .result-card li { margin-bottom: 6px; line-height: 1.6; }
        
        /* å°èˆªæŒ‰éˆ•æ¨£å¼ */
        .map-btn {
            display: inline-block;
            background-color: #27ae60;
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-top: 10px;
            width: fit-content;
        }
        .map-btn:hover { background-color: #219150; }

        /* è®“ Markdown è§£æå¾Œçš„å…ƒç´ ç¬¦åˆå¡ç‰‡æ¨£å¼ */
        #result h3 { color: #2d98da; border-bottom: 1px solid #eee; padding-bottom: 8px; margin-top: 1.5rem; }
    </style>
</head>
<body>

<div class="container">
    <div class="nav-header"><a href="restaurant.html" class="nav-link">ğŸ½ï¸ åˆ‡æ›è‡³é¤å»³è©•é‘‘ â†’</a></div>
    <h2>ğŸ‡«ğŸ‡· æ³•åœ‹æ—…éŠè¬äº‹é€š</h2>
    
    <div id="loginSection" class="section active">
        <label>è«‹è¼¸å…¥ Gemini API Key ğŸ”‘</label>
        <input type="password" id="apiKeyInput" placeholder="è²¼ä¸Š Key (æš«å­˜æ–¼æ­¤åˆ†é )">
        <button onclick="saveKey()">ç¢ºèªä¸¦é–‹å§‹ä½¿ç”¨</button>
    </div>

    <div id="searchSection" class="section">
        <div class="top-bar"><span>âœ… API Key å·²å°±ç·’</span><span class="reset-link" onclick="clearKey()">ğŸ”„ é‡è¨­ Key</span></div>
        
        <label>ğŸ“ æ‚¨åœ¨å“ªè£¡ï¼Ÿ(åœ°é»/åœ°å€/åœ°æ¨™)</label>
        <input type="text" id="locationInput" placeholder="ä¾‹å¦‚ï¼šç¾…æµ®å®®ã€Nice Riquierç«è»Šç«™">

        <label>ğŸ” æƒ³æ‰¾ä»€éº¼ï¼Ÿ</label>
        <input type="text" id="queryInput" placeholder="ä¾‹å¦‚ï¼šå’–å•¡å»³ã€è—¥å±€ã€è¶…å¸‚ã€æ™¯é»">
        
        <button onclick="startAnalysis()" id="btn">ğŸš€ æœå°‹é™„è¿‘æ¨è–¦</button>

        <div id="status"></div>
        <div id="result"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
    window.onload = function() { checkSession(); };
    const apiKeyInput = document.getElementById('apiKeyInput');
    const locationInput = document.getElementById('locationInput');
    const queryInput = document.getElementById('queryInput');

    // æ³¨æ„ï¼šå·²ç§»é™¤ Enter éµç›£è½

    function checkSession() {
        if (sessionStorage.getItem('geminiKey')) showSearchUI();
        else showLoginUI();
    }

    function saveKey() {
        const key = apiKeyInput.value.trim();
        if (!key) { alert("è«‹è¼¸å…¥ API Key"); return; }
        sessionStorage.setItem('geminiKey', key);
        showSearchUI();
    }

    function clearKey() {
        sessionStorage.removeItem('geminiKey');
        document.getElementById('result').innerHTML = '';
        apiKeyInput.value = ''; 
        showLoginUI();
    }

    function showLoginUI() {
        document.getElementById('loginSection').classList.add('active');
        document.getElementById('searchSection').classList.remove('active');
    }

    function showSearchUI() {
        document.getElementById('loginSection').classList.remove('active');
        document.getElementById('searchSection').classList.add('active');
    }

    async function startAnalysis() {
        const apiKey = sessionStorage.getItem('geminiKey');
        const location = locationInput.value;
        const query = queryInput.value;
        const resultDiv = document.getElementById('result');
        const statusDiv = document.getElementById('status');
        const btn = document.getElementById('btn');

        if (!apiKey) { clearKey(); return; }
        if (!location || !query) { alert("è«‹å¡«å¯«åœ°é»å’Œæƒ³æ‰¾ä»€éº¼"); return; }

        resultDiv.innerHTML = '';
        btn.disabled = true;
        statusDiv.innerHTML = 'ğŸ§­ æ­£åœ¨æ¨¡æ“¬ Google Maps æœå°‹é‚è¼¯...';

        try {
            // æŒ‡å®šä½¿ç”¨ gemini-2.5-flash
            const modelName = 'gemini-2.5-flash';
            
            statusDiv.innerHTML = `âœ… é€£ç·šæˆåŠŸ (ä½¿ç”¨æ¨¡å‹: ${modelName})<br>ğŸ” æ­£åœ¨ç‚ºæ‚¨ç¯©é¸æœ€ä½³å»è™•...`;

            // æ‰‹æ©Ÿç‰ˆé¢å„ªåŒ– Prompt
            const prompt = `
                ä½ æ˜¯ä¸€ä½è¬›è©±å¯¦åœ¨ã€éå¸¸ç†Ÿæ‚‰æ³•åœ‹çš„åœ¨åœ°å°éŠã€‚ä½¿ç”¨è€…ç›®å‰ä½æ–¼ã€Œ${location}ã€ã€‚
                ä»–æƒ³è¦å°‹æ‰¾é™„è¿‘çš„ã€Œ${query}ã€ã€‚
                
                é‡è¦æŒ‡ä»¤ï¼š
                1. **æº–ç¢ºæ€§å„ªå…ˆ**ï¼šè«‹æ¨¡æ“¬ Google Maps æˆ– Tripadvisor çš„æœå°‹çµæœã€‚åš´ç¦æé€ ä¸å­˜åœ¨çš„åº—ã€‚å¦‚æœè©²åœ°é»é™„è¿‘çœŸçš„æ²’æœ‰ä½¿ç”¨è€…è¦æ‰¾çš„æ±è¥¿ï¼ˆä¾‹å¦‚åœ¨ä½å®…å€æ‰¾ç™¾è²¨å…¬å¸ï¼‰ï¼Œè«‹è€å¯¦å‘ŠçŸ¥ã€‚
                2. **æ‰‹æ©Ÿç‰ˆé¢å„ªåŒ–**ï¼šä¸è¦ä½¿ç”¨è¡¨æ ¼ (Table)ï¼Œè«‹ä½¿ç”¨ã€Œå¡ç‰‡å¼ã€çš„æ¢åˆ—æ ¼å¼ã€‚
                3. **é€£çµæœ‰æ•ˆæ€§**ï¼šåœ°åœ–é€£çµè«‹ä½¿ç”¨ Google æœå°‹èªæ³•ï¼Œä¸è¦è‡ªå·±ç”¢ç”Ÿåº§æ¨™é€£çµã€‚
                
                è«‹æ¨è–¦ 3 åˆ° 5 å€‹æœ€ä½³é¸æ“‡ï¼Œæ¯å€‹é¸æ“‡è«‹ä¾ç…§ä»¥ä¸‹ Markdown æ ¼å¼è¼¸å‡ºï¼ˆè«‹åš´æ ¼éµå®ˆï¼‰ï¼š

                <div class="result-card">
                ### åº—å/æ™¯é»å
                * **è·é›¢/ä½ç½®**ï¼š(ä¾‹å¦‚ï¼šèµ°è·¯5åˆ†é˜ï¼Œä½æ–¼xxæ—)
                * **ç‰¹è‰²/è©•åƒ¹**ï¼š(Tripadvisor æˆ– Google è©•åƒ¹æ‘˜è¦)
                * **åƒ¹æ ¼/è©•åˆ†**ï¼š
                * <a href="https://www.google.com/maps/search/?api=1&query={æŠŠåº—åèˆ‡åŸå¸‚æ‹¼åœ¨ä¸€èµ·çš„è‹±æ–‡åç¨±}" target="_blank" class="map-btn">ğŸ“ é–‹å•Ÿåœ°åœ– / å°èˆª</a>
                </div>

                (è«‹é‡è¤‡ä¸Šè¿°å€å¡Š 3-5 æ¬¡)

                æœ€å¾Œçµ¦ä¸€å€‹ç°¡çŸ­çš„ **ã€Œå°éŠå»ºè­°ã€**ã€‚
            `;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });

            if (!response.ok) throw new Error("API é€£ç·šå¤±æ•—");

            const data = await response.json();
            const text = data.candidates[0].content.parts[0].text;
            
            // å…è¨± HTML æ¨™ç±¤ä»¥æ¸²æŸ“å¡ç‰‡ div
            resultDiv.innerHTML = marked.parse(text);
            statusDiv.innerHTML = 'âœ¨ æœå°‹å®Œæˆ';

        } catch (error) {
            resultDiv.innerHTML = `<span style="color:#fc5c65;">âŒ éŒ¯èª¤: ${error.message}</span>`;
            statusDiv.innerHTML = '';
        } finally {
            btn.disabled = false;
        }
    }
</script>
</body>
</html>
